#include "wForgePCH.hpp"
#include "SceneData.hpp"

namespace wForge {
    SceneData::SceneData()
        : m_components(),
        m_transforms(),
        m_meshRenderers(),
        m_scripts(),
        m_names()
    {

    }

    struct IntermediateData
    {
        struct ComponentTocken
        {
            ComponentTocken(uint32_t tabulation, uint32_t typeNameIndex, uint32_t nameIndex)
                : tabulation(tabulation), typeNameIndex(typeNameIndex), nameIndex(nameIndex)
            {
            }
            uint32_t tabulation;
            std::string_view typeNameIndex;
            std::string_view nameIndex;
        }

        IntermediateData()
            : names()
        {
        }


        std::vector<ComponentTocken> componentTockens;
    }

    bool SceneData::LoadSceneFromString(const std::string_view& sceneStr, ErrorList& errorList)
    {
        IntermediateData intData;

        size_t i = 0;
        while (i < sceneStr.size())
        {
            intData.componentTockens.push_back(Com
        }

        /*std::vector<std::string_view> strings;
	    size_t i = 0;
        while (i < sceneStr.size())
        {
            char ch = sceneStr[i];
            if (isalpha(ch))
            {
                std::optional<std::string_view> name = GetTypeName(i, sceneStr, errorList);
                if (!name)
                {
                    return false;
                }
                strings.push_back(name.value());
            }
            else if (ch == '"' || ch == '\'')
            {
                std::optional<std::string_view> string = GetString(i, sceneStr, errorList);
                if (!string)
                {
                    return false;
                }
                strings.push_back(string.value());
            }
            ++i;
        }
        for (std::string_view str : strings)
        {
            W_LOG_DEBUG("{}", str);
        }
        return true;*/
    }

    bool SceneData::IsValidTypeName(const std::string_view& typeName)
    {
        if (std::isalpha(typeName[0]))
        {
            return false;
        }

        for (size_t i = 1; i < typeName.length(); ++i)
        {
            char ch = typeName[i];
            if (!(std::isalpha(ch) || std::isdigit(ch) || ch == '_'))
            {
                return false;
            }
        }

        return true;
    }

    std::optional<std::string_view> SceneData::GetTypeName(size_t& i, const std::string_view& sceneStr, ErrorList& errorList)
    {
        const size_t startIndex = i;
        ++i;
        while (i < sceneStr.size())
        {
            const char ch = sceneStr[i];
            if (!(std::isalpha(ch) || std::isdigit(ch) || ch == '_'))
            {
                return sceneStr.substr(startIndex, i - startIndex);
            }
            ++i;
        }
        return {};
    }

    std::optional<std::string_view> SceneData::GetString(size_t& i, const std::string_view& sceneStr, ErrorList& errorList)
    {
        const char quoteChar = sceneStr[i];
        ++i;
        const size_t startIndex = i;
        while (i < sceneStr.size())
        {
            const char ch = sceneStr[i];
            if (ch == quoteChar)
            {
                return sceneStr.substr(startIndex, i - startIndex);
            }
            ++i;
        }
        return {};
    }
}
